{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Eventos ‚Äì Central de Eventos</title>

    <!-- CSS externo -->
    <link rel="stylesheet" href="{% static 'main/style/events_list.css' %}">
</head>
<body>
<div class="page">
    <div class="shell">

        <!-- MENU LATERAL -->
        <aside class="sidebar">
            <div>
                <div class="sidebar-logo">CEUB</div>

                <nav class="sidebar-menu">
                    <a href="{% url 'dashboard_page' %}" class="menu-item">
                        <span class="icon">üè†</span>
                        <span>In√≠cio</span>
                    </a>

                    <a href="{% url 'event_dashboard' %}" class="menu-item active">
                        <span class="icon">üìÖ</span>
                        <span>Eventos</span>
                    </a>

                    <a href="{% url 'temporary_subscription_page' %}" class="menu-item">
                        <span class="icon">üìù</span>
                        <span>Inscri√ß√µes</span>
                    </a>

                    <a href="{% url 'temporary_user_profile' %}" class="menu-item">
                        <span class="icon">üë§</span>
                        <span>Perfil</span>
                    </a>
                </nav>
            </div>

            <a href="{% url 'logout' %}" class="sidebar-footer" style="text-decoration:none; color:white;">
                <span class="icon">‚Ü©Ô∏è</span>
                <span>Sair</span>
            </a>
        </aside>

        <!-- CONTE√öDO PRINCIPAL -->
        <main class="main">
            <header class="topbar">
                <div class="topbar-left">
                    <h1>Eventos</h1>

                    <div class="search-box">
                        üîç
                        <input type="text" placeholder="Search">
                    </div>
                </div>

                <div class="topbar-right">
                    <div class="circle-icon" id="themeToggle">üåô</div>
                    <div class="circle-icon">üîî</div>
                    <div class="circle-icon">üë§</div>
                    <button class="btn-perfil" id="btnPerfil">
                        Perfil | {{ user.first_name|default:user.username }}
                    </button>

                    <!-- DROPDOWN DO PERFIL -->
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-header">
                            <div class="user-avatar">
                                {% if user.first_name %}
                                    {{ user.first_name|first|upper }}
                                {% else %}
                                    {{ user.username|first|upper }}
                                {% endif %}
                            </div>
                            <div>
                                <div class="user-name">
                                    {{ user.first_name|default:user.username }}
                                </div>
                                <div class="user-email">
                                    {{ user.email }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </header>

            <!-- CONTE√öDO DA P√ÅGINA DE EVENTOS -->
            <section class="content-events">

                <!-- T√çTULO + FILTROS -->
                <div class="events-list-header-bar">
                    <div>
                        <h2 class="events-list-main-title">Eventos dispon√≠veis</h2>
                        <p class="events-list-subtitle">
                            Veja todos os eventos cadastrados e acesse os detalhes para se inscrever.
                        </p>
                    </div>

                    <div class="events-list-filters">
                        <form method="get">
                            <select name="status" class="events-filter-select">
                                <option value="">Todos os status</option>
                                <option value="Ativo" {% if request.GET.status == "Ativo" %}selected{% endif %}>Ativos</option>
                                <option value="Rascunho" {% if request.GET.status == "Rascunho" %}selected{% endif %}>Rascunhos</option>
                                <option value="Encerrado" {% if request.GET.status == "Encerrado" %}selected{% endif %}>Encerrados</option>
                                <option value="Cancelado" {% if request.GET.status == "Cancelado" %}selected{% endif %}>Cancelados</option>
                            </select>

                            <input type="text"
                                   name="q"
                                   class="events-filter-search"
                                   placeholder="Buscar por t√≠tulo ou local"
                                   value="{{ request.GET.q|default:'' }}">

                            <button type="submit" class="btn-yellow events-filter-btn">
                                Filtrar
                            </button>
                        </form>
                    </div>
                </div>

                <!-- GRID DE EVENTOS -->
                <div class="events-grid">
                    {% if eventos %}
                        {% for evento in eventos %}
                            <article class="event-item">
                                <header class="event-item-header">
                                    <h3 class="event-item-title">{{ evento.titulo }}</h3>

                                    <span class="event-status-pill
                                        {% if evento.status == 'Ativo' %}status-ativo
                                        {% elif evento.status == 'Encerrado' %}status-encerrado
                                        {% elif evento.status == 'Cancelado' %}status-cancelado
                                        {% else %}status-rascunho{% endif %}">
                                        {{ evento.status }}
                                    </span>
                                </header>

                                <p class="event-item-description">
                                    {{ evento.descricao|truncatechars:140 }}
                                </p>

                                <div class="event-item-infos">
                                    <div class="event-info-block">
                                        <span class="event-info-label">Data</span>
                                        <span class="event-info-value">
                                            {{ evento.data_inicio|date:"d/m/Y" }}
                                            {% if evento.data_fim and evento.data_fim != evento.data_inicio %}
                                                ‚Äì {{ evento.data_fim|date:"d/m/Y" }}
                                            {% endif %}
                                        </span>
                                    </div>

                                    <div class="event-info-block">
                                        <span class="event-info-label">Hor√°rio</span>
                                        <span class="event-info-value">
                                            {{ evento.horario_inicio|time:"H:i" }} ‚Äì {{ evento.horario_fim|time:"H:i" }}
                                        </span>
                                    </div>

                                    <div class="event-info-block">
                                        <span class="event-info-label">Local</span>
                                        <span class="event-info-value">{{ evento.localizacao }}</span>
                                    </div>

                                    <div class="event-info-block">
                                        <span class="event-info-label">Vagas</span>
                                        <span class="event-info-value">
                                            {{ evento.total_inscricoes }} / {{ evento.quantidade_vagas }}
                                        </span>
                                    </div>
                                </div>

                                <footer class="event-item-footer">
                                    <div class="event-item-organizer">
                                        <span class="event-info-label">Organizador</span>
                                        <span class="event-info-value">
                                            {{ evento.organizador.user.get_full_name|default:evento.organizador.user.username }}
                                        </span>
                                    </div>

                                    <a href="{% url 'event_detail' evento.id %}"
                                       class="btn-yellow event-item-btn">
                                        Ver detalhes
                                    </a>
                                </footer>
                            </article>
                        {% endfor %}
                    {% else %}
                        <div class="events-empty-state">
                            <p>N√£o h√° eventos cadastrados no momento.</p>
                        </div>
                    {% endif %}
                </div>

            </section>
        </main>
    </div>
</div>

<script>
    const body = document.body;
    const toggle = document.getElementById('themeToggle');
    const savedTheme = localStorage.getItem('theme') || 'light';

    const btnPerfil = document.getElementById('btnPerfil');
    const dropdown = document.getElementById('userDropdown');

    if (savedTheme === 'dark') {
        body.classList.add('dark-mode');
    }

    toggle.addEventListener('click', function () {
        body.classList.toggle('dark-mode');
        const newTheme = body.classList.contains('dark-mode') ? 'dark' : 'light';
        localStorage.setItem('theme', newTheme);
    });

    btnPerfil.addEventListener('click', function (event) {
        event.stopPropagation();
        dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
    });

    document.addEventListener('click', function (event) {
        if (dropdown.style.display === 'block' &&
            !dropdown.contains(event.target) &&
            !btnPerfil.contains(event.target)) {
            dropdown.style.display = 'none';
        }
    });
</script>
</body>
</html>
